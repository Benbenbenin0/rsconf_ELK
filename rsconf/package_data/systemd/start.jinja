#!/bin/bash
#
# Usage: run [bash -l]
#
set -euo pipefail
# Needed to allow for empty commands (e.g. docker_registry), bash will complain
# if an variable is empty as unbound (set -u above)
image_cmd=( '{{ systemd_image }}' )
flags='--name {{ systemd_service_name }} '
if (( $# > 0 )); then
    flags='-i '
    image_cmd+=( $@ )
else
    image_cmd+=( {{ systemd_cmd }} )
fi
exec docker run $flags --tty --rm --user={{ systemd_run_u }} --net host {{ systemd_volumes }} "${image_cmd[@]}"
